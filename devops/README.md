# NLW Unite Devops

> Evento da RocketSeat

## Terraform

### Códigos Fonte

[digital ocean database](/devops/terraform/)

### Comandos

- terraform init
- terraform fmt
- terraform plan
- terraform apply -auto-approve
- terraform plan --destroy

### Links úteis

- [Terraform Registry](https://registry.terraform.io/)
- [Terraform digitalocean_database_cluster](https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/database_cluster)
- [digitalocean_database_db](https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/database_db) <-

## Kubernetes (k8s)

### Códigos Fonte

[namespace test](/devops/k8s-example-with-nginx/)

[namespace nlw](/devops/k8s/)

### Comandos

#### Cluster

- k3d cluster create nlw-unite --servers 2
- kubectl cluster-info

#### Infos

- kubectl get nodes
- kubectl get pods
- kubectl get pods -n nlw
- kubectl get pods -n kube-system

#### Namespace test

- kubectl create ns test
- kubectl get pods -n test
- kubectl apply -f k8s-example-with-nginx/deployment.yaml -n test
- kubectl get deployment -n test
- kubectl get pods -n test
- kubectl get replicaset -n test
- kubectl port-forward pod/[pod-name] -n test 3333:80
- kubectl apply -f k8s-example-with-nginx -n test
- kubectl get service -n test
- kubectl port-forward svc/nginx-service -n test 3333:80

#### Namespace nlw

- kubectl create ns nlw
- kubectl apply -f k8s -n nlw
- kubectl get deployment -n nlw
- watch kubectl get pods -n nlw
- kubectl logs [pod-name] -n nlw
- kubectl top pods -n nlw
- kubectl top nodes -n nlw
- kubectl port-forward svc/passin-service -n test 3333:3001
- kubectl apply -f k8s -n nlw
- kubectl get pods -n nlw

## Helm

### Comandos

- helm create deploy

### Códigos Fonte

[Generated by helm create deploy](/devops/deploy/)

### Comandos continuação

#### Base (dentro da pasta deploy)

- kubectl create ns nlw-helm
- helm upgrade --install passin ./deploy -n nlw-helm
- kubectl get pods -n nlw-helm
- helm list -n nlw-helm
- kubectl logs [pod-name] -n nlw-helm

#### Argo CD

- kubectl create namespace argocd
- kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
- kubectl get svc -n argocd
- kubectl port-forward svc/argocd-server -n argocd 3001:80
- kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
- [browser] http://localhost:3001 user:admin password:[secret retornado acima]

#### Código font

[cross](/devops/cross/apps/passin/)

#### Argo CD continuação (dentro da pasta cross)

- kubectl apply -n argocd -f apps/passin
- [browser] http://localhost:3001
- kubectl delete -n nlw
- kubectl delete -n nlw-helm
- kubectl create ns nlw
- kubectl port-forward svc/argocd-server -n argocd 3001:80
- [browser] http://localhost:3001
- watch kubectl get pods -n nlw
- kubectl port-forward svc/nlw-passin-deploy -n nlw 3333:80
- [browser] http://localhost:3333/docs

#### Adicionando healthz endpoint

- kubectl port-forward svc/nlw-passin-deploy -n nlw 3333:80
- [browser] http://localhost:3333/healthz

### AWS EKS

#### Comandos (pasta cross)

- aws configure sso
- aws eks --region us-east-2 update-kubeconfig --name nlw-k8s
- kubectl get pods -n kube-system
- kubectl create namespace argocd
- kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
- kubectl apply -n argocd -f apps/passin
- kubectl port-forward svc/argocd-server -n argocd 3001:80
- kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
- [browser] http://localhost:3001 user:admin password:[secret retornado acima]
- kubectl create ns nlw
- [browser] http://localhost:3001 sync
- watch kubectl get pods -n nlw

### Links úteis

- [Argo CD Docs](https://argo-cd.readthedocs.io/en/stable)
